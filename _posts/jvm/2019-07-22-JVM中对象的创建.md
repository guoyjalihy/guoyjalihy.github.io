---
layout: post
title:  "JVM中对象的创建"
date:   2019-07-22 15:00:01 +0800
categories: jvm
---

#### 对象的创建过程
    类加载检查->分配内存->初始化0值->设置头信息->执行init方法
1. 类加载检查  
   jvm接收到new命令后，在方法区的运行时常量区内检查该类是否已经加载过，如无，则先执行类加载过程。
2. 内存分配  
   从堆内存中划分一块儿内存给当前类，类加载完就可以知道一个类实例化需要多大的空间。
3. 初始化0值  
   初始化完就可以java程序中使用了
4. 设置头信息  
   该实例属于哪个类的、类的元数据信息、hash值等
5. 执行<init>方法  
   按照开发人员的要求进行初始化赋值      

#### 内存分配的两种方法
1. 指针碰撞法
   堆内存中通过指针一分为二，左边塞满了对象，右边为空闲区域，分配内存时指针后移即可，适用于规整型的垃圾回收机制，采用标记-整理算法，如Serial、ParNew
2. 空闲列表法
   维护一个空闲列表，分配时从空闲列表中获取地址，适用标记-删除算法的垃圾回收器，如CMS
  
#### 内存分配时高并发问题的解决
   JVM中创建对象是很频繁的，所以会经常的分配内存，如何避免高并发下内存分配冲突的问题。  
1. CAS+失败重试机制  
   乐观锁实现  
2. TLAB(Thread Local Allocation Buffer)方式     
   在Eden区分配一块儿当前线程私有的空间。  
   缺点：容易空间浪费，增加垃圾回收成本